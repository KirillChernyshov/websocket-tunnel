# WebSocket Tunnel Project

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
```
[–î—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä] -> HTTP –∑–∞–ø—Ä–æ—Å -> [–†–∞–±–æ—á–∏–π —Å–µ—Ä–≤–µ—Ä] -> WebSocket -> [–í–∞—à –ü–ö] -> HTTP –∑–∞–ø—Ä–æ—Å -> [–õ–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ]
                                        ^                              |
                                        |<-- WebSocket –æ—Ç–≤–µ—Ç <--------|
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### 1. –†–∞–±–æ—á–∏–π —Å–µ—Ä–≤–µ—Ä (src/server/)
- **HTTP —Å–µ—Ä–≤–µ—Ä** –Ω–∞ Express.js –¥–ª—è –ø—Ä–∏–µ–º–∞ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **WebSocket —Å–µ—Ä–≤–µ—Ä** –¥–ª—è —Å–≤—è–∑–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (–≤–∞—à–∏–º–∏ –ü–ö)
- **–û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤** –¥–ª—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä** –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏

#### 2. –ö–ª–∏–µ–Ω—Ç –Ω–∞ –ü–ö (src/client/)
- **WebSocket –∫–ª–∏–µ–Ω—Ç** –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ä–∞–±–æ—á–µ–º—É —Å–µ—Ä–≤–µ—Ä—É
- **HTTP –∫–ª–∏–µ–Ω—Ç** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** –ø—Ä–∏ –æ–±—Ä—ã–≤–∞—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤** –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è WebSocket —Å–æ–æ–±—â–µ–Ω–∏–π –≤ HTTP

### –ü—Ä–æ—Ç–æ–∫–æ–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

#### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π WebSocket:
```typescript
interface TunnelMessage {
  id: string;
  type: 'request' | 'response' | 'error' | 'heartbeat' | 'register';
  timestamp: number;
  payload?: any;
}

interface HttpRequestPayload {
  method: string;
  path: string;
  headers: Record<string, string>;
  body?: string;
  query?: Record<string, string>;
}

interface HttpResponsePayload {
  statusCode: number;
  headers: Record<string, string>;
  body: string;
}
```

### –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å ‚úÖ
- [x] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
- [x] WebSocket —Å–µ—Ä–≤–µ—Ä –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å–µ—Ä–≤–µ—Ä–µ
- [x] WebSocket –∫–ª–∏–µ–Ω—Ç –Ω–∞ –ü–ö
- [x] –ë–∞–∑–æ–≤—ã–π HTTP proxy —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- [x] –°–∏—Å—Ç–µ–º–∞ —Ç–∏–ø–æ–≤ TypeScript
- [x] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- [x] –¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä

#### –≠—Ç–∞–ø 2: –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- [ ] –û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- [ ] –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–µ —Å–≤—è–∑–∏
- [ ] Heartbeat –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### –≠—Ç–∞–ø 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- [ ] –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã

#### –≠—Ç–∞–ø 4: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- [ ] HTTPS/WSS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ IP
- [ ] –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
src/
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts           # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ websocket.ts       # WebSocket —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ http-proxy.ts      # HTTP proxy –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ client-manager.ts  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ types.ts           # –¢–∏–ø—ã TypeScript
‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts           # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∫–ª–∏–µ–Ω—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ websocket.ts       # WebSocket –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ http-client.ts     # HTTP –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ config.ts          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ shared/
    ‚îî‚îÄ‚îÄ types.ts           # –û–±—â–∏–µ —Ç–∏–ø—ã
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –°–µ—Ä–≤–µ—Ä (.env):
```
PORT=3000
WS_PORT=3001
TARGET_URL=http://localhost:8080
```

#### –ö–ª–∏–µ–Ω—Ç (.env):
```
SERVER_WS_URL=ws://your-work-server:3001
LOCAL_TARGET=http://localhost:8080
CLIENT_ID=pc-client-1
```

### –ó–∞–ø—É—Å–∫ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
   ```bash
   npm install
   ```

2. **–°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
   ```bash
   npm run build
   ```

3. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞ —Ä–∞–±–æ—á–µ–º —Å–µ—Ä–≤–µ—Ä–µ):**
   ```bash
   npm run start:server
   ```

4. **–ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–∞ –≤–∞—à–µ–º –ü–ö):**
   ```bash
   npm run start:client
   ```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å–µ—Ä–≤–µ—Ä
curl -X POST http://work-server:3000/api/test \
  -H "Content-Type: application/json" \
  -d '{"message": "hello"}'
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- –õ–æ–≥ –æ—à–∏–±–æ–∫ –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Ç—É–Ω–Ω–µ–ª—è

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
npm install
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–∏–º–∏—Ç–∞—Ü–∏—è –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è):**
```bash
npm run dev:test-server
# –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ http://localhost:8080
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 - –ó–∞–ø—É—Å–∫ —Ç—É–Ω–Ω–µ–ª—å-—Å–µ—Ä–≤–µ—Ä–∞ (–∏–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—á–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞):**
```bash
npm run dev:server
# HTTP —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 3000, WebSocket –Ω–∞ 3001
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 3 - –ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ (–≤–∞—à –ü–ö):**
```bash
npm run dev:client
# –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ 2
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—É–Ω–Ω–µ–ª—è

**–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 4 - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:**
```bash
# –ü—Ä–æ—Å—Ç–æ–π GET –∑–∞–ø—Ä–æ—Å
curl http://localhost:3000/api/test

# POST –∑–∞–ø—Ä–æ—Å —Å –¥–∞–Ω–Ω—ã–º–∏
curl -X POST http://localhost:3000/api/echo \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello through tunnel!"}'

# PUT –∑–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
curl -X PUT http://localhost:3000/api/data/123?version=2 \
  -H "Content-Type: application/json" \
  -d '{"name": "Updated Item"}'

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
curl "http://localhost:3000/api/slow?delay=3000"

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
curl http://localhost:3000/api/error/404
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã
```bash
# –°—Ç–∞—Ç—É—Å —Ç—É–Ω–Ω–µ–ª—è
curl http://localhost:3000/health

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö
curl http://localhost:3000/status
```

## üöÄ –ü—Ä–æ–¥–∞–∫—à–Ω –¥–µ–ø–ª–æ–π

### –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (PM2)

**–ù–∞ —Ä–∞–±–æ—á–µ–º —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —Å–µ—Ä–≤–µ—Ä–∞
./deploy.sh server
```

**–ù–∞ –≤–∞—à–µ–º –ü–ö:**
```bash
# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∏–µ–Ω—Ç
echo "SERVER_WS_URL=ws://your-server.com:3001" > .env
echo "LOCAL_TARGET=http://localhost:8080" >> .env
./deploy.sh client
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 list

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 logs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
./health-check.sh

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
pm2 monit
```

üìö **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:**
- üéØ [**DEPLOY.md**](./DEPLOY.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- üìñ [**PRODUCTION.md**](./PRODUCTION.md) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—É
- ‚ö° [**QUICKSTART.md**](./QUICKSTART.md) - –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π WebSocket —Å–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å HTTP proxy —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é —Ä–∞–±–æ—Ç—É
4. üîÑ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (—É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
5. üîú –î–æ–±–∞–≤–∏—Ç—å HTTPS/WSS –ø–æ–¥–¥–µ—Ä–∂–∫—É
6. üîú –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
